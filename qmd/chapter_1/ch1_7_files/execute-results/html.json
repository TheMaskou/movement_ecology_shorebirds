{
  "hash": "0dafcfb056ca61c57c7a2dd963edaf8b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Station usage rate\"\nformat: html\n---\n\n\n\n::: {.callout style=\"border-left: 6px solid #D99B8F; --bs-callout-border: #D99B8F; padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;\"}\n**This page** (finally!) **describes and summarises where** (*Motus station*) **and when** (*tidal condition*) **the birds were.**\n\nThe total amount of **hours** and the **usage rate** are assessed for each individual being detected within the Motus array and across the different tidal conditions such as:\n\n-   Diurnal High Tide\n\n-   Diurnal Low Tide\n\n-   Nocturnal High Tide\n\n-   Nocturnal Low Tide\n\nPlus, globally visualise the **conditions of detection** across the tagged population.\n\n*It is surprising to see how much we actually do ignore...*\n:::\n\n::: blockquote-blue\n**Load your data** in your R environment *- see [Load & Format \\> Reproducibility](qmd/chapter_1/ch1_1.qmd)*\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(motus)\nlibrary(dplyr)\nlibrary(here)\nlibrary(forcats) \nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(tidyr)\nlibrary(purrr)\nlibrary(readr)\nlibrary(bioRad)\nlibrary(hms)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(scales)\n```\n:::\n\n\nAnd **load** your `activity` table too!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrecv.act <- tbl(sql.motus, \"activity\")  %>% \n  collect() %>% \n  as.data.frame() %>%\n  rename(deviceID = \"motusDeviceID\") %>%\n  # keep our deployed antennas only\n  filter(deviceID %in% unique(recv$deviceID)) %>% \n  # Set the time properly - IMPORTANT\n  mutate(date = as_datetime(as.POSIXct(hourBin* 3600,\n                                       origin = \"1970-01-06\", \n                                       tz = \"UTC\")),\n         dateAus = as_datetime(as.POSIXct(hourBin* 3600, \n                                          origin = \"1970-01-06\", \n                                          tz = \"UTC\"), \n                               tz = \"Australia/Sydney\"))   \n```\n:::\n\n\n\n\n## Pre-requisite\n\nThis analysis compares the time available for each tidal category (Diurnal High Tide, Nocturnal High Tide, Diurnal Low Tide and Nocturnal Low tide) with the time each shorebird species spent at Motus stations.\n\nFirst, we need to determine the available time for each species group and for each Motus station. Second, we need to calculate the time used for each bird in every species and for each MOTUS stations too.\n\n[*The below procedure breaks down how we assessed:*]{.underline}\n\n-   **Tide variable**\n-   **The time *available***\n-   **The time *used***\n\n::: {style=\"display: flex; align-items: center; justify-content: center; min-height: 60vh;\"}\n<figure style=\"text-align: center; max-width: 950px; width: 90%; margin: 0 auto;\">\n\n<img src=\"../../material/available_used_schema.png\" alt=\"Schema 1: Definition of available and used periods across bird individuals and Motus stations\" style=\"width: 100%; height: auto; display: block;\"/>\n\n<figcaption style=\"margin-top: 1em; font-style: italic;\">\n\nSchema: Definition of available and used periods across bird individuals and Motus stations\n\n</figcaption>\n\n</figure>\n:::\n\n### TIDE VARIABLE\n\nBased on [New South Wales Tide Tables](https://www.bom.gov.au/oceanography/projects/ntc/nsw_tide_tables.shtml) we were able to extract and classify the total time for each of the four categories of tide that occurred within the Hunter estuary. Note that one data-set is provided at the estuary scale, therefore, we assume the tide is occurring at the same scale, time, frequency and amplitude across our MOTUS station.\n\nTide table informs for Low and High tide peaks. Half of the period between peak *n* and peak *n-1* is taken, added to the period between peak *n* and peak *n+1*, then expanded in hours for further analysis. The tide associated to peak *n* defines its variable period (i.e. red lines below is defined as high tide since peak *n* is a high tide peak).\n\n::: {style=\"display: flex; align-items: center; justify-content: center; min-height: 60vh;\"}\n<figure style=\"text-align: center; max-width: 950px; width: 90%; margin: 0 auto;\">\n\n<img src=\"../../material/tide.png\" alt=\"Schema 2: Definition of tide variables (high or low) for one period\" style=\"width: 100%; height: auto; display: block;\"/>\n\n<figcaption style=\"margin-top: 1em; font-style: italic;\">\n\nSchema: Definition of tide variables (high or low) for one period (red line)\n\n</figcaption>\n\n</figure>\n:::\n\n\n```{.r .cell-code}\ntide_data <- tide_data %>%\n  arrange(tideDateTimeAus) %>%\n  mutate(prev_time = lag(tideDateTimeAus),\n         next_time = lead(tideDateTimeAus) ) %>%\n  filter(!is.na(prev_time) & !is.na(next_time)) %>%\n  mutate(duration_h = as.numeric(difftime(tideDateTimeAus, prev_time, units = \"hours\")/2 + \n                                    difftime(next_time, tideDateTimeAus, units = \"hours\")/2)) %>%\n  \n  mutate(sunriseNewc = sunrise(tideDateTimeAus, 151.7833, -32.9167, elev = -0.268, tz = \"Australia/Sydney\", force_tz = TRUE),\n         sunsetNewc = sunset(tideDateTimeAus, 151.7833, -32.9167, elev = -0.268, tz = \"Australia/Sydney\", force_tz = TRUE),\n         sunriseNewcTime = strftime(sunriseNewc, format = \"%H:%M:%S\", tz = \"Australia/Sydney\"),\n         sunsetNewcTime = strftime(sunsetNewc, format = \"%H:%M:%S\", tz = \"Australia/Sydney\")) %>%\n  \n  mutate(tideDiel = case_when(tideDateTimeAus < sunriseNewc ~ \"Nocturnal\",\n                               tideDateTimeAus > sunriseNewc & tideDateTimeAus < sunsetNewc ~ \"Diurnal\",\n                               tideDateTimeAus > sunsetNewc ~ \"Nocturnal\")) %>%\n  \n  mutate(tideCategory = case_when(high_low == \"Low\" & tideDiel == \"Diurnal\" ~ \"Diurnal_Low\",\n                                  high_low == \"Low\" & tideDiel == \"Nocturnal\" ~ \"Nocturnal_Low\",\n                                  high_low == \"High\" & tideDiel == \"Diurnal\" ~ \"Diurnal_High\",\n                                  high_low == \"High\" & tideDiel == \"Nocturnal\" ~ \"Nocturnal_High\") %>% \n           as_factor()) %>%\n  rename(tideHighLow = high_low,\n         timeAus = tideDateTimeAus) %>%\n  select(timeAus, tideCategory, tideHighLow, tideDiel, duration_h, sunriseNewc, sunsetNewc)\n```\n\n### TIME AVAILABLE\n\nNow tide data ready to be processed, we need to define for each individual (birds) and across each Motus stations, what was the amount of time available for the four tide categories.\n\nAvailable time for each Motus stations is accessed with `activity` table: each row is a dated record of noise or a tag detected *- see [Survey effort \\> Activity table](qmd/chapter_1/ch1_5.qmd)*.\n\nWe need to extract the temporal coverage of each station, starting from deployment date to the last recorded activity, and expand this period in hours.\n\n<br>\n\n\n```{.r .cell-code}\n# Sort the terminated serno (if terminated, ie. one box removed from one antenna site, a date comes along)\n# but still needed for accessing survey effort as the station is currently running with another serno \nrecv.act.term <- recv.act %>%\n  left_join(recv %>% \n              filter(!is.na(timeEndAus)) %>%\n              select(deviceID, serno, recvDeployName),\n            \"deviceID\") %>%\n  filter(!is.na(recvDeployName)) %>%\n  mutate(SernoStation = paste0(recvDeployName, \"_\", serno))\n\n# Sort the currently running serno\nrecv.act.runn <- recv.act %>%\n  left_join(recv %>% \n              filter(is.na(timeEndAus)) %>%\n              select(deviceID, serno, recvDeployName),\n            \"deviceID\") %>%\n  filter(!is.na(recvDeployName)) %>%\n  mutate(SernoStation = paste0(recvDeployName, \"_\", serno))\n\n# Merging in one data-set to use Station's name further + pick-up the rounded hours\nrecv.act <- bind_rows(recv.act.runn, recv.act.term) %>%\n  mutate(hour_dt = round_date(dateAus, \"hour\"))\n\n# Providing helpful variables\nrecv <- recv %>%\n  mutate(SernoStation = paste0(recvDeployName, \"_\", serno),\n         lisStart = timeStartAus,\n         lisEnd = if_else(\n           is.na(timeEndAus), # means the station is still running since the last data downloading\n           with_tz(Sys.time(), \"Australia/Sydney\"),\n           with_tz(as_datetime(timeEndAus, tz = \"UTC\"), \"Australia/Sydney\")) )\n\n# Generating hourly sequences per SernoStation from start to end dates of the deviceID at particular sites\nrecv_hours <- recv %>%\n  select(recvDeployName, deviceID, SernoStation, lisStart, lisEnd) %>%\n  group_by(SernoStation) %>%\n  rowwise() %>%\n  mutate(hour_dt = list(seq(from = round_date(lisStart, unit = \"hour\"),\n                            to = round_date(lisEnd, unit = \"hour\"),\n                            by = \"hour\")) ) %>%\n  unnest(cols = c(hour_dt)) %>%\n  ungroup()\n\n# Simplify station variables (recvDeployName)\nrecv <- recv %>% \n  select(!recvDeployName) \nrecv$recvDeployName <- sub(\"_SG-.*\", \"\", recv$SernoStation)\n\nrecv_hours <- recv_hours %>% \n  select(!recvDeployName) \nrecv_hours$recvDeployName <- sub(\"_SG-.*\", \"\", recv_hours$SernoStation)\n```\n\n<br>\n\nWe now how the complete temporal coverage, expanded in hours, for each Motus station.\n\nHowever, due to some temporary failures or maintenance *(see [Survey effort \\> Operational periods](qmd/chapter_1/ch1_5.qmd))*, the actual period a station was operational may be different than the complete temporal coverage. So, we must determine when a station was not operational and substract these off-hours to the complete temporal coverage.\n\n<br>\n\n\n```{.r .cell-code}\n# Distinguish station from mixed recv + Giving operational variable (= TRUE when existing values from act table)\nrecv_hours <- recv_hours %>%\n  left_join(recv.act %>%\n              distinct(recvDeployName, hour_dt) %>%\n              mutate(operational = TRUE),\n            by = c(\"recvDeployName\", \"hour_dt\")) %>%\n  mutate(operational = if_else(is.na(operational), FALSE, TRUE))\n\n# /!\\ Due to unknown error? Have to set this manually\nrecv_hours <- recv_hours %>%\n  mutate(operational = case_when(\n    recvDeployName == \"Fullerton Entrance\" & \n      hour_dt > as.POSIXct(\"2023-04-02\") & \n      hour_dt < as.POSIXct(\"2023-04-05\") ~ FALSE,\n    TRUE ~ operational))\n\n# Summary table                                                                     \noff_runs <- recv_hours %>% \n  arrange(recvDeployName, hour_dt) %>%\n  group_by(recvDeployName) %>%\n  mutate(off_run_id = consecutive_id(operational == FALSE)) %>%\n  ungroup() %>%\n  \n  filter(operational == FALSE) %>%\n  \n  group_by(recvDeployName, off_run_id) %>%\n  summarise(\n    start_off = min(hour_dt),\n    end_off = max(hour_dt),\n    tot_off_hours = n(),\n    .groups = \"drop\") %>%\n  \n  filter(tot_off_hours > 24)\n\n# Unique recvDeployNames from off_runs\nrecv_names <- unique(recv_hours$recvDeployName)\n\n# Split tide_data into a named list with one element per recvDeployName\ntide_data_list <- setNames(vector(\"list\", length(recv_names)), recv_names)\n\nfor(name in recv_names) {\n  # Get off intervals for this recvDeployName\n  intervals <- off_runs %>%\n    filter(recvDeployName == name) %>%\n    select(start_off, end_off)\n  \n  # Get deployment start and end dates for this recvDeployName\n  deploy <- recv_hours %>%\n    filter(recvDeployName == name) %>%\n    summarise(\n      lisStart = min(lisStart, na.rm = TRUE),\n      lisEnd = max(lisEnd, na.rm = TRUE)\n    )\n  \n  # Filter tide_data by deployment period\n  td <- tide_data %>%\n    filter(timeAus >= deploy$lisStart & timeAus <= deploy$lisEnd) %>%\n    mutate(recvDeployName = name) \n  \n  if(nrow(intervals) > 0) {\n    # Vectorized exclusion of off intervals\n    is_in_off <- sapply(td$timeAus, function(t) {\n      any(t >= intervals$start_off & t <= intervals$end_off)\n    })\n    td <- td[!is_in_off, ]\n  }\n  tide_data_list[[name]] <- td\n}\n\ntide_data_df <- bind_rows(tide_data_list) %>%\n  mutate(hour_dt = round_date(timeAus, unit = \"hour\"))            # AVAILABLE TIME (tide categories covering same time as recv survey effort) \n\ntotal_recv_tide_data <- tide_data_df %>%\n  group_by(recvDeployName) %>%\n  summarise(hour_seq = list(seq(min(hour_dt), max(hour_dt), by = \"hour\")), .groups = \"drop\") %>%\n  unnest(hour_seq) %>%\n  rename(hour_dt = hour_seq) %>%\n  \n  left_join(tide_data_df, by = c(\"recvDeployName\", \"hour_dt\")) %>%\n  arrange(recvDeployName, hour_dt) %>%\n  group_by(recvDeployName) %>%\n  mutate(across(everything(), ~ zoo::na.locf(.x, na.rm = FALSE), .names = \"{.col}\"))\n```\n\n<br>\n\n**Temporal coverage for each station is now reduced to its operational periods**, and ready to be processed.\n\nWe now assign each bird its own available time period, spanning from its tagging date to its last Motus detection, and expanded to hourly resolution too.\n\n<br>\n\n\n```{.r .cell-code}\n# Get the monitored period of each bird\nperiod_sp <- data_all  %>%\n  group_by(Band.ID) %>%\n  reframe(DateAUS.Trap = first(DateAUS.Trap), \n          last_dateAus = max(dateAus),\n          speciesEN = speciesEN) %>%\n  unique()\n\n# Expand one row per hours to each individual across its whole period (this is the available time)\nbird_hours <- period_sp %>%\n  group_by(Band.ID) %>%\n  rowwise() %>%\n  mutate(hour_dt = list(seq(from = as.POSIXct(ymd(DateAUS.Trap), tz = \"UTC\"),\n                            to = as.POSIXct(last_dateAus, tz = \"UTC\"),\n                            by = \"hour\"))) %>%\n  unnest(cols = c(hour_dt)) %>%\n  ungroup() \n\n# Add tide category for each available hours\nfind_closest_tide <- function(target_time) {\n  # Calculate absolute time differences\n  time_diffs <- as.numeric(tide_data$timeAus - target_time, units = \"mins\")\n  closest_idx <- which.min(abs(time_diffs))\n  return(tide_data$tideCategory[closest_idx])\n}\nbird_hours <- bird_hours %>%\n  mutate(tideCategory = sapply(hour_dt, find_closest_tide))\n\n# Duplicate in as many list as many stations\nrecv_names <- unique(recv_hours$recvDeployName)\nbird_data_list <- setNames(vector(\"list\", length(recv_names)), recv_names)\n\nfor(name in recv_names) {\n  \n  valid_hours_recv <- total_recv_tide_data %>%\n    filter(recvDeployName == name) %>%\n    pull(hour_dt)\n  \n  valid_hours_bird_recv <- bird_hours %>%\n    filter(hour_dt %in% valid_hours_recv)\n  \n  valid_hours_bird_recv$name <- name\n  \n    \n  bird_data_list[[name]] <- valid_hours_bird_recv\n} \n\n# AVAILABLE TIME (tide categories covering same time as recv survey effort AND birds monitoring period)\navailable_bird_recv_time <- bind_rows(bird_data_list) %>%\n  rename(recvDeployName = name) %>%\n  group_by(Band.ID, speciesEN, recvDeployName, tideCategory)  %>%\n  summarise(duration_h = n()) %>%\n  mutate(tideDiel = if_else(grepl(\"Diurnal\", tideCategory), \"Diurnal\", \"Nocturnal\"),\n         tideHighLow = if_else(grepl(\"High\", tideCategory), \"High\", \"Low\")) \n```\n\n::: blockquote-blue\n**The *available* time is now defined for each bird across each Motus station, taking into account the periods where stations where ON only. The *available* periods are expanded in hours.**\n:::\n\n### TIME USED\n\nLet's now determine the time *used* for each bird for each Motus station.\n\n::: blockquote-blue\n**The time *used* is defined by multiplying the number of detections (meaning the number of rows) by the duration of a pulse (pulse interval).** We assume that if an individual is detected by a receiver once, the individual was at least in the station coverage for the duration of the signal pulse. Duration differ depending tag models *- see table below*.\n:::\n\n::: {style=\"display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh;\"}\n<figure>\n\n<img src=\"../../material/pulse_interval.png\" alt=\"Table X: Pulse Interval depending Lotek nanotag models\" style=\"display: block; margin: auto; width: 90vw; max-width: 950px; height: auto;\"/>\n\n<figcaption style=\"text-align: center; margin-top: 0.5em;\">\n\nPulse Interval depending Lotek nanotag models\n\n</figcaption>\n\n</figure>\n:::\n\n\n```{.r .cell-code}\n# USED TIME (amount of time each bird spent during each category of tide and at each station)\n\n# Provide the burst interval value depending Lotek-nano tag model (scd)\ndata_bird <- data_all %>%\n  mutate(burst_inter = ifelse(tagModel == \"NTQB2-6-2\", dseconds(7.1), dseconds(13.1))) %>%\n  select(timeAus, tideCategory, tideHighLow, tideDiel, sunriseNewc, sunsetNewc, \n         speciesEN, tagModel, recvDeployName, recv,speciesSci, Band.ID, burst_inter)\n\nused_bird_recv_time <- data_bird %>%\n  group_by(Band.ID, speciesEN, recvDeployName, tideCategory)  %>%\n  summarise(duration_sec = sum(burst_inter)) %>%\n  mutate(duration_h = round(duration_sec / 3600, 0),\n         tideDiel = if_else(grepl(\"Diurnal\", tideCategory), \"Diurnal\", \"Nocturnal\"),\n         tideHighLow = if_else(grepl(\"High\", tideCategory), \"High\", \"Low\")) %>%\n  select(speciesEN, tideCategory, tideDiel, tideHighLow, duration_h, recvDeployName)\n```\n\n## Usage rate\n\nNow that the *used* and *available* time have been determined for each individual and for each Motus station, we can relate these two elements together with the **Usage rate** (or rate of use).\n\n$$\n\\text{Usage rate} = \\frac{\\text{Time used}}{\\text{Time available}} \\times 100 \\quad \\textit{across stations and species}\n$$ Some cases may happen where the *time used* was over the *available*. It may occur because multiplying each bird detection by its pulse interval duration overestimates the actual time used. For example, if a bird is detected twice with a 13-second pulse interval—once at second 1 and again at second 14—this results in 2 detections over 14 seconds. However, simply multiplying the detections by the pulse interval (2 × 13 seconds) incorrectly estimates the total time used as 26 seconds.\\\n<br>\n\n\n```{=html}\n<div id=\"mdkvtmmebs\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#mdkvtmmebs table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#mdkvtmmebs thead, #mdkvtmmebs tbody, #mdkvtmmebs tfoot, #mdkvtmmebs tr, #mdkvtmmebs td, #mdkvtmmebs th {\n  border-style: none;\n}\n\n#mdkvtmmebs p {\n  margin: 0;\n  padding: 0;\n}\n\n#mdkvtmmebs .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#mdkvtmmebs .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#mdkvtmmebs .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#mdkvtmmebs .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#mdkvtmmebs .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#mdkvtmmebs .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#mdkvtmmebs .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#mdkvtmmebs .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#mdkvtmmebs .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#mdkvtmmebs .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#mdkvtmmebs .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#mdkvtmmebs .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#mdkvtmmebs .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#mdkvtmmebs .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#mdkvtmmebs .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mdkvtmmebs .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#mdkvtmmebs .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#mdkvtmmebs .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#mdkvtmmebs .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mdkvtmmebs .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#mdkvtmmebs .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mdkvtmmebs .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#mdkvtmmebs .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mdkvtmmebs .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#mdkvtmmebs .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mdkvtmmebs .gt_left {\n  text-align: left;\n}\n\n#mdkvtmmebs .gt_center {\n  text-align: center;\n}\n\n#mdkvtmmebs .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#mdkvtmmebs .gt_font_normal {\n  font-weight: normal;\n}\n\n#mdkvtmmebs .gt_font_bold {\n  font-weight: bold;\n}\n\n#mdkvtmmebs .gt_font_italic {\n  font-style: italic;\n}\n\n#mdkvtmmebs .gt_super {\n  font-size: 65%;\n}\n\n#mdkvtmmebs .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#mdkvtmmebs .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#mdkvtmmebs .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#mdkvtmmebs .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#mdkvtmmebs .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#mdkvtmmebs .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#mdkvtmmebs .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#mdkvtmmebs .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#mdkvtmmebs div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"available_t\">available_t</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"tideDiel\">tideDiel</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"tideHighLow\">tideHighLow</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"used_t\">used_t</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold;\" scope=\"col\" id=\"rate_use\">rate_use</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"5\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_Low\">Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_Low</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_Low  available_t\" class=\"gt_row gt_right\">347</td>\n<td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_Low  tideDiel\" class=\"gt_row gt_left\">Diurnal</td>\n<td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_Low  tideHighLow\" class=\"gt_row gt_left\">Low</td>\n<td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_Low  used_t\" class=\"gt_row gt_right\">351</td>\n<td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_Low  rate_use\" class=\"gt_row gt_right\">101.1527</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"5\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_High\">Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_High</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_High  available_t\" class=\"gt_row gt_right\">438</td>\n<td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_High  tideDiel\" class=\"gt_row gt_left\">Diurnal</td>\n<td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_High  tideHighLow\" class=\"gt_row gt_left\">High</td>\n<td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_High  used_t\" class=\"gt_row gt_right\">461</td>\n<td headers=\"Curlew Point - 06318617 - Pacific Golden-Plover - Diurnal_High  rate_use\" class=\"gt_row gt_right\">105.2511</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"5\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Curlew Point - 07176824 - Bar-tailed Godwit - Nocturnal_High\">Curlew Point - 07176824 - Bar-tailed Godwit - Nocturnal_High</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Curlew Point - 07176824 - Bar-tailed Godwit - Nocturnal_High  available_t\" class=\"gt_row gt_right\">6</td>\n<td headers=\"Curlew Point - 07176824 - Bar-tailed Godwit - Nocturnal_High  tideDiel\" class=\"gt_row gt_left\">Nocturnal</td>\n<td headers=\"Curlew Point - 07176824 - Bar-tailed Godwit - Nocturnal_High  tideHighLow\" class=\"gt_row gt_left\">High</td>\n<td headers=\"Curlew Point - 07176824 - Bar-tailed Godwit - Nocturnal_High  used_t\" class=\"gt_row gt_right\">8</td>\n<td headers=\"Curlew Point - 07176824 - Bar-tailed Godwit - Nocturnal_High  rate_use\" class=\"gt_row gt_right\">133.3333</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"5\" class=\"gt_group_heading\" scope=\"colgroup\" id=\"Tomago - 07176824 - Bar-tailed Godwit - Nocturnal_High\">Tomago - 07176824 - Bar-tailed Godwit - Nocturnal_High</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Tomago - 07176824 - Bar-tailed Godwit - Nocturnal_High  available_t\" class=\"gt_row gt_right\">6</td>\n<td headers=\"Tomago - 07176824 - Bar-tailed Godwit - Nocturnal_High  tideDiel\" class=\"gt_row gt_left\">Nocturnal</td>\n<td headers=\"Tomago - 07176824 - Bar-tailed Godwit - Nocturnal_High  tideHighLow\" class=\"gt_row gt_left\">High</td>\n<td headers=\"Tomago - 07176824 - Bar-tailed Godwit - Nocturnal_High  used_t\" class=\"gt_row gt_right\">9</td>\n<td headers=\"Tomago - 07176824 - Bar-tailed Godwit - Nocturnal_High  rate_use\" class=\"gt_row gt_right\">150.0000</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\nWe removed **n = 4** out of 1251 cases where the *time used* was over the *available*.\n\nThis limitation is currently ignored and not taken into account into the analysis regarding the general low ratio time used/time available.\n\n\n```{.r .cell-code}\nfigure_plot <- left_join(available_bird_recv_time %>% \n                           group_by(recvDeployName, Band.ID, speciesEN, tideCategory) %>%\n                           rename(available_t = \"duration_h\"),\n                         used_bird_recv_time %>%\n                           rename(used_t = \"duration_h\")) %>%\n  mutate(rate_use = used_t*100/available_t) %>%\n  mutate(rate_use = ifelse(rate_use > 100, 100, rate_use)) %>%\n  mutate(speciesType = factor(shorebird_class[speciesEN], \n                               levels = c(\"migratory\", \"resident\"))) %>%\n  filter(!speciesEN %in% c(\"Far Eastern Curlew\", \"Masked Lapwing\"),\n         rate_use != 100) \n```\n\nWe filtered out Masked Lapwing and Far Eastern Curlew from the analysis, since they have too few data. <br>\n\n\n```{.r .cell-code}\n# Track size sample\ncounts <- used_bird_recv_time %>%\n      group_by(speciesEN) %>%\n      summarise(n = n_distinct(Band.ID)) %>%\n      mutate(label = paste0(speciesEN, \" (n = \", n, \")\"))\nlabel_vec <- setNames(counts$label, counts$speciesEN)\n```\n\n\n```{.r .cell-code}\n# Tide and species groupings\ntide_levels <- c(\"Low\", \"High\")\nspecies_types <- unique(shorebird_class)  \n\n# Function to generate a plot for a given combination\nmake_plot <- function(tide_level, species_type) {\n  data_sub <- figure_plot %>%\n    filter(tideHighLow == tide_level) %>%\n    mutate(species_class = shorebird_class[speciesEN]) %>%\n    filter(species_class == species_type)\n  \n  ggplot(data_sub,\n    aes(x    = factor(recvDeployName, levels = sort(unique(recvDeployName))),\n        y    = rate_use,\n        fill = tideDiel)) +\n    geom_boxplot() +\n    facet_wrap(~ speciesEN,\n               labeller = labeller(speciesEN = label_vec)) +\n    labs(x     = \"Receiver Deployment\",\n         y     = \"Rate of Use (%)\",\n         fill  = \"Tide Diel\",\n         title = paste(ifelse(species_type == \"migratory\",\n                              \"Migratory species\", \"Resident species\"),\n                       \"during\", tide_level, \"tide\")) +\n    coord_cartesian(ylim = c(0, 50)) +\n    theme_minimal() +\n    scale_fill_manual(values = c(\"Diurnal\" = \"white\", \"Nocturnal\" = \"darkgrey\")) +\n    theme(axis.text.x = element_text(angle = 45, hjust = 1))\n}\n\n# Generate and store all plots in a list\nplots_used_rate <- cross2(tide_levels, species_types) %>%\n  purrr::map(~ make_plot(.x[[1]], .x[[2]]))\n```\n\n### RESIDENT BIRDS\n\n::: panel-tabset\n##### High Tide\n\n![](ch1_7_files/figure-html/4 Used rate 1-1.png){width=672}\n\n##### Low Tide\n\n![](ch1_7_files/figure-html/4 Used rate 2-1.png){width=672}\n:::\n\n### MIGRATORY BIRDS\n\n::: panel-tabset\n##### High Tide\n\n![](ch1_7_files/figure-html/4 Used rate 3-1.png){width=672}\n\n##### Low Tide\n\n![](ch1_7_files/figure-html/4 Used rate 4-1.png){width=672}\n:::\n\n## Hourly usage\n\n### USED vs AVAILABLE\n\n\n\n::: panel-tabset\n##### Nocturnal High Tide\n\n![](ch1_7_files/figure-html/4 1-1.png){width=672}\n\n##### Diurnal Low Tide\n\n![](ch1_7_files/figure-html/4 2-1.png){width=672}\n\n##### Diurnal High Tide\n\n![](ch1_7_files/figure-html/4 3-1.png){width=672}\n\n##### Nocturnal Low Tide\n\n![](ch1_7_files/figure-html/4 4-1.png){width=672}\n:::\n\n**Legend**: Shorebird movement and spatial ecology vary across species and within the local MOTUS array in NSW. Each tab displays one category from the pairs \"high/low\" and \"nocturnal/diurnal,\" showing *used time* for each species at different MOTUS stations (red boxes). The blue box on the left represents the total *available time* for the corresponding tide category across individuals. Note that *available time* is similar across stations as it is based on the general Newcastle tide table, since station-specific tide data is unavailable.\n\n### USED\n\nSince the size sample at the current date is too low, it might be hard to read in details how much each bird or species spent time (hours) at each Motus station. So here below is displayed the *used* only for each stations.\n\n\n```{.r .cell-code}\n# Plot function used ONLY\nplot_used <- function(tide_cat) {\n  data_subset <- used_bird_recv_time %>% filter(tideCategory == tide_cat)\n  \n  ggplot(data_subset, \n         aes(x = recvDeployName, y = duration_h, fill = speciesEN)) +\n    \n    geom_boxplot(position = position_dodge2(width = 0.9, preserve = \"single\")) +\n    scale_fill_manual(values = species_colors, name = \"Species\") +\n    \n    facet_wrap(~ speciesEN, scales = \"free_y\", \n               labeller = labeller(speciesEN = label_vec)) +\n    \n    theme_minimal(base_size = 12) +\n    theme(strip.text = element_text(face = \"bold\", size = 10),\n          axis.text.x = element_text(angle = 45, hjust = 1),\n          legend.position = \"none\",\n          plot.margin = margin(0, 0, 0, 0, \"in\"))  +\n    \n    coord_cartesian(ylim = c(0, NA)) + \n    labs(x = \"Motus stations\",\n         y = \"Detection duration (hours)\",\n         title = paste(\"Tide Category:\", tide_cat),\n         fill = \"Species\")\n  }\n\n# Get unique tideCategory levels\ntide_categories <- combined_data %>%\n  filter(!is.na(tideCategory)) %>%\n  pull(tideCategory) %>%\n  unique()\n\n# Generate a list of plots for all tide categories\nplots_list_used <- purrr::map(tide_categories, plot_used)\n```\n\n::: panel-tabset\n##### Nocturnal Low Tide\n\n![](ch1_7_files/figure-html/4 used 1-1.png){width=672}\n\n##### Nocturnal High Tide\n\n![](ch1_7_files/figure-html/4 used 2-1.png){width=672}\n\n##### Diurnal High Tide\n\n![](ch1_7_files/figure-html/4 used 3-1.png){width=672}\n\n##### Diurnal Low Tide\n\n![](ch1_7_files/figure-html/4 used 4-1.png){width=672}\n:::\n\n## Detection conditions\n\nVisualise here the difference between the total number of hours recorded across the four tidal conditions for each species and for the whole population of tagged shorebirds, \"**Total used**\". And see the difference with the \"**Usage rate**\", which measures bird detections by the Motus array as a proportion of the total available detection time.\n\n\n\n### POPULATION\n\n**Usage rate**\n\n![](ch1_7_files/figure-html/global rou-1.png){width=672}\n\n**Total used**\n\n![](ch1_7_files/figure-html/global hours-1.png){width=672}\n\n### SPECIES\n\n**Usage rate**\n\n![](ch1_7_files/figure-html/sp rou-1.png){width=672}\n\n**Total used**\n\n![](ch1_7_files/figure-html/sp hours-1.png){width=672}\n",
    "supporting": [
      "ch1_7_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}